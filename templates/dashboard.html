
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OpenAlgo Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f0f2f5; }
    aside { width: 220px; background: #1c1c1c; color: white; height: 100vh; position: fixed; }
    aside h2 { text-align: center; padding: 15px 0; color: #61dafb; }
    aside ul { list-style: none; padding: 0; }
    aside li { padding: 15px 20px; border-bottom: 1px solid #333; cursor: pointer; }
    aside li:hover, aside li.active { background: #333; }
    header {
      position: fixed; top: 0; left: 220px; right: 0;
      background: #fff; padding: 10px 20px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 100;
    }
    main { margin-left: 220px; padding: 80px 20px 40px; }
    .section { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .btn { padding: 6px 12px; background: #007BFF; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin: 2px; }
    .btn:hover { background: #0056b3; }
    input, select, textarea { padding: 8px; margin: 8px 0; width: 100%; max-width: 400px; display: block; }
    .toggle { transform: scale(1.3); margin: 0 8px; vertical-align: middle; }
    .card { padding: 10px; margin-bottom: 10px; background: #fafafa; border: 1px solid #ccc; border-radius: 8px; }
    .green { color: green; }
    .red { color: red; }
    #toast {
      position: fixed; bottom: 30px; left: 50%;
      transform: translateX(-50%); background: #28a745;
      color: #fff; padding: 10px 20px; border-radius: 6px;
      display: none; z-index: 999;
    }
  </style>
</head>
<body>
<aside>
  <h2>OpenAlgo</h2>
  <ul>
    <li onclick="showTab('accountConfig')" class="active">Account Configuration</li>
    <li onclick="showTab('copyTrading')">Copy Trading</li>
  <li onclick="showTab('tradeSummary')">Trade Summary</li></ul>
</aside>

<header>
  <div>
    <label>ðŸŒ— Dark Mode <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()"></label>
  </div>
  <div style="position: relative;">
    <button onclick="toggleUserMenu()">ðŸ‘¤ â–¾</button>
    <div id="userMenu" style="display:none; position:absolute; right:0; background:white; border-radius:5px; box-shadow:0 0 5px rgba(0,0,0,0.2); z-index:999;">
      <a href="/dashboard">User Dashboard</a>
      <a href="/security">Security Settings</a>
      <a href="/logout">Logout</a>
    </div>
  </div>
</header>

<main>
  <!-- Account Configuration -->
<div class="section" id="accountConfig">
  <h3>âž• Add Zerodha Account</h3>

<form onsubmit="addAccount(); return false;" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
  <input id="clientId" placeholder="Client ID" required style="width: 140px;" />
  <input id="apiKey" placeholder="API Key" required style="width: 140px;" />
  <input id="apiSecret" placeholder="API Secret" required style="width: 140px;" />
  <input id="totpKey" placeholder="TOTP Key" required style="width: 140px;" />
  <input id="emailId" placeholder="Email (optional)" style="width: 160px;" />
  <input id="mobileNo" placeholder="Mobile (optional)" style="width: 140px;" />
  <button class="btn" type="submit">Add</button>
</form>

  <h4 style="margin-top: 20px;">ðŸ“‹ Added Accounts</h4>
  <table style="width:100%; border-collapse: collapse;" border="1" cellpadding="6">
    <thead>
      <tr>
        <th>Client ID</th>
        <th>Opening Balance</th>
        <th>Auto-Login</th>
        <th>Last Login</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="addedAccountsTable">
      <tr>
        <td>Z123456</td>
        <td>â‚¹1,00,000</td>
        <td><input type="checkbox" checked /></td>
        <td>2025-05-01 08:45</td>
        <td>
          <button class="btn">Reconnect</button>
          <button class="btn">Edit</button>
          <button class="btn">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<div id="successAccounts"></div>
    <div id="failedAccounts"></div>
  </div>

<!-- Enhanced Master + Child Copy Trading Panel -->
<div class="section" id="copyTrading" style="display:none;">
  <h3>ðŸ“‹ Copy Trading Panel</h3>

  <!-- Master Account -->
  
  <div class="card" id="masterCard" style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 10px;">
    <div><strong>Client ID:</strong> <span id="masterClientId">ZMASTER123</span></div>
    <div>AutoLogin: <input type="checkbox" onchange="toggleMasterAutoLogin(this.checked)"></div>
    <div>Balance: â‚¹<span id="masterBalance">75,000</span></div>
    <div>Multiplier:
      <select onchange="setMasterMultiplier(this.value)">
<option value="0.5">0.5x</option>
<option value="1">1x</option>
<option value="2">2x</option>
<option value="3">3x</option>
<option value="4">4x</option>
<option value="5">5x</option>
<option value="6">6x</option>
<option value="7">7x</option>
<option value="8">8x</option>
<option value="9">9x</option>
<option value="10">10x</option>
</select>
    </div>
    <div>Copy: <input type="checkbox" onchange="toggleMasterCopy(this.checked)"></div>
    <div>All Child: <input type="checkbox" onchange="toggleAllChildCopy(this.checked)"></div>
    <div>P&L: <span id="masterPnL" class="green">+â‚¹1,200</span></div>
    <div>Net P&L: <span id="masterNetPnL" class="green">+â‚¹2,500</span></div>
    <div>
      <button class="btn" onclick="showConsoleTab('master','orderbook')">Order Book</button>
      <button class="btn" onclick="showConsoleTab('master','positions')">Positions</button>
    </div>
    <div>
      <button class="btn" onclick="exitMaster()">Exit</button>
      <button class="btn" onclick="editMaster()">Edit</button>
      <button class="btn" onclick="deleteMaster()">Delete</button>
    </div>
    <div style="flex-basis: 100%; margin-top: 10px;">
      <div id="master_orderbook" class="console-tab" style="display:none;">
        <textarea style="width:100%; height:100px;" readonly>Order Book will load here...</textarea>
      </div>
      <div id="master_positions" class="console-tab" style="display:none;">
        <textarea style="width:100%; height:100px;" readonly>Positions will load here...</textarea>
      </div>
    </div>
  </div>
  <hr/>
    

  <!-- Child Accounts -->
  <h4>Child Accounts</h4>
  <table style="width:100%; border-collapse: collapse;" border="1" cellpadding="6">
    <thead>
      <tr>
        <th>Client ID</th><th>AutoLogin</th><th>Live Balance</th><th>Multiplier</th>
        <th>Trade</th><th>Console</th><th>Exit</th><th>P&L</th><th>Net P&L</th><th>Edit/Delete</th>
      </tr>
    </thead>
    <tbody id="childAccountsBody">
      <tr>
        <td>ZCHILD001</td>
        <td><input type="checkbox" onchange="toggleChildAutoLogin('ZCHILD001', this.checked)"></td>
        <td>â‚¹42,000</td>
        <td>
          <select onchange="updateChildMultiplier(this.value)">
<option value="0.5">0.5x</option>
<option value="1">1x</option>
<option value="2">2x</option>
<option value="3">3x</option>
<option value="4">4x</option>
<option value="5">5x</option>
<option value="6">6x</option>
<option value="7">7x</option>
<option value="8">8x</option>
<option value="9">9x</option>
<option value="10">10x</option>
</select>
        </td>
        <td><input type="checkbox" checked onchange="toggleChildTrade('ZCHILD001', this.checked)"></td>
        <td>
          <button class="btn" onclick="showConsoleTab('ZCHILD001','orderbook')">ðŸ“’</button>
          <button class="btn" onclick="showConsoleTab('ZCHILD001','positions')">ðŸ“ˆ</button>
        </td>
        <td><button class="btn" onclick="exitChild('ZCHILD001')">Exit</button></td>
        <td><span class="green">+â‚¹950</span></td>
        <td><span class="green">+â‚¹1,850</span></td>
        <td>
          <button class="btn" onclick="editChild('ZCHILD001')">Edit</button>
          <button class="btn" onclick="deleteChild('ZCHILD001')">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div id="ZCHILD001_orderbook" class="console-tab" style="display:none; margin-top:10px;">
    <textarea style="width:100%; height:100px;" readonly>Child ZCHILD001 Order Book here...</textarea>
  </div>
  <div id="ZCHILD001_positions" class="console-tab" style="display:none; margin-top:10px;">
    <textarea style="width:100%; height:100px;" readonly>Child ZCHILD001 Positions here...</textarea>
  </div>
</div>

<script>
function showConsoleTab(account, tab) {
  document.querySelectorAll('.console-tab').forEach(el => el.style.display = 'none');
  const el = document.getElementById(account + "_" + tab);
  if (el) el.style.display = 'block';
}
</script>

<!-- TAB BUTTONS -->
  <div style="margin-bottom: 10px;">
    <button class="btn" onclick="showCopyTab('details')">ðŸ‘¥ Child Accounts</button>
    <button class="btn" onclick="showCopyTab('orders')">ðŸ“‹ Order History</button>
    <button class="btn" onclick="showCopyTab('summary')">ðŸ“Š Trade Summary</button>
  </div>

  <!-- TAB 1: CHILD ACCOUNTS -->
  <div id="copyTabDetails">
    <h4>ðŸ‘¥ Child Accounts</h4>
    <p>Child account info appears here.</p>
  </div>

  <!-- TAB 2: ORDER HISTORY -->
  <div id="copyTabOrders" style="display:none;">
    <h4>ðŸ“‹ Order History</h4>
    <table>
      <thead>
        <tr>
          <th>Symbol</th><th>Account</th><th>Timestamp</th><th>Quantity</th><th>Avg Price</th>
          <th>Action</th><th>Order ID</th><th>Status</th><th>Error</th>
        </tr>
      </thead>
      <tbody id="orderHistoryTableBody">
        <tr><td colspan="9">No orders yet.</td></tr>
      </tbody>
    </table>
  </div>

  <!-- TAB 3: TRADE SUMMARY -->
  

<div class="section" id="tradeSummary" style="display:none;">
  <h3>ðŸ“Š Trade Summary (Live)</h3>
  <table style="width:100%; border-collapse: collapse;" border="1" cellpadding="8">
    <thead>
      <tr>
        <th>Account</th><th>Opening Balance</th><th>Net P&L</th><th>Total Trades</th>
        <th>Total Volume</th><th>Win</th><th>Loss</th><th>Win Rate (%)</th><th>Top Symbol</th>
      </tr>
    </thead>
    <tbody id="tradeSummaryTableBody">
      <tr><td colspan="9">Loading...</td></tr>
    </tbody>
  </table>
</div>

</main>
<script>
function toggleUserMenu() {
  const menu = document.getElementById("userMenu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}
function showTab(id) {
  document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
  document.getElementById(id).style.display = 'block';
  document.querySelectorAll('aside li').forEach(li => li.classList.remove('active'));
  document.querySelector(`aside li[onclick="showTab('${id}')"]`).classList.add('active');
}
function toggleDarkMode() {
  const dark = document.getElementById("dark-mode-toggle").checked;
  document.body.style.background = dark ? "#121212" : "#f0f2f5";
  document.body.style.color = dark ? "#eee" : "#000";
  document.querySelectorAll(".section, .card").forEach(el => {
    el.style.background = dark ? "#1e1e1e" : "#fff";
    el.style.color = dark ? "#f0f0f0" : "#000";
  });
  document.querySelector("aside").style.background = dark ? "#000" : "#1c1c1c";
}
</script>

<!-- Floating Buttons -->


<script>
function showCopyTab(tab) {
  document.getElementById("copyTabDetails").style.display = tab === "details" ? "block" : "none";
  document.getElementById("copyTabOrders").style.display = tab === "orders" ? "block" : "none";
  document.getElementById("copyTabSummary").style.display = tab === "summary" ? "block" : "none";
  if (tab === "summary") loadTradeSummary();
}

function loadTradeSummary() {
  fetch('/get-accounts-summary')
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("tradeSummaryTableBody");
      tbody.innerHTML = "";
      data.accounts
        .sort((a, b) => b.net_pnl - a.net_pnl)
        .forEach(acc => {
          const tr = document.createElement("tr");
          const pnlClass = acc.net_pnl >= 0 ? "green" : "red";
          tr.innerHTML = `
            <td>${acc.name}</td>
            <td>â‚¹${acc.opening_balance}</td>
            <td class="${pnlClass}">â‚¹${acc.net_pnl}</td>
            <td>${acc.total_trades}</td>
            <td>${acc.total_volume}</td>
            <td>${acc.wins}</td>
            <td>${acc.losses}</td>
            <td>${acc.win_rate}%</td>
            <td>${acc.top_symbol}</td>
          `;
          tbody.appendChild(tr);
        });
    });
}
</script>
</body>
</html>
