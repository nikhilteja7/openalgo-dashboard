<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OpenAlgo Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f0f2f5; }
    .card { border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin: 10px 0; }
    .green { color: green; }
    .red { color: red; }
    .bg-dark { background-color: #121212 !important; }
    .text-white { color: #f1f1f1 !important; }
    .table-dark { background-color: #2c2c2c; color: #f1f1f1; }
    #accounts tr td button { margin-right: 5px; }
    details[open] > summary::before { content: "â–¼ "; }
    details > summary::before { content: "â–¶ "; }
    summary { cursor: pointer; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    #logoutBtn { background: #dc3545; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <label>ðŸŒ— Dark Mode <input type="checkbox" id="dark-mode-toggle"></label>
    <button id="logoutBtn" onclick="logout()">ðŸšª Logout</button>
  </header>

  <nav style="display: flex; gap: 10px; padding: 10px; background: #ddd;">
  <button onclick="showTab('accountSection')">Account Configuration</button>
  <button onclick="showTab('copySection')">Copy Trading</button>
  <button onclick="showTab('summarySection')">Trade Summary</button>
  <button onclick="showTab('chartinkSection')">Chartink Triggers</button>
</nav>
<main>
    <section id="accountSection">
      <h2>Account Configuration</h2>
      <button id="sortToggle" onclick="loadAccounts()">Sort by Net P&L</button>
      <div id="netPnl"></div>
      <button onclick="toggleAddForm()">âž• Add Account</button>
<details id="addAccountForm" style="margin: 10px 0;" open>
  <summary><strong>âž• Fill New Account Details</strong></summary>
  <div style="margin-top: 10px;">
    <input id="clientId" placeholder="Client ID" required />
    <input id="apiKey" placeholder="API Key" required />
    <input id="apiSecret" placeholder="API Secret" required />
    <input id="totpKey" placeholder="TOTP Key" required />
    <input id="emailId" placeholder="Email (optional)" type="email" />
    <input id="mobileNo" placeholder="Mobile (optional)" type="tel" pattern="[0-9]{10}" />
    <button onclick="if (!isDuplicateAccount()) addAccount()">Submit</button>
  </div>
</details>
<table border="1" width="100%" style="margin-top: 15px; border-collapse: collapse;">
  <thead>
    <tr style="background:#eee">
      <th>Client ID</th>
      <th>Opening Balance</th>
      <th>Login Time</th>
      <th>AutoLogin</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="accounts">
  </tbody>
</table>
    </section>

    <section id="accountSection">
      <h2>Copy Trading</h2>
      <label>Master:</label><select id="masterSelect"></select>
      <label>Child:</label><select id="childSelect"></select>
      <div id="masterClientId"></div>
      <div>Balance: â‚¹<span id="masterBalance"></span></div>
      <div>Today's P&L: â‚¹<span id="masterPnl"></span></div>
      <div>Net P&L: â‚¹<span id="masterNetPnl"></span></div>
      <label>Copy All Child: <input type="checkbox" id="copyAllToggle" onchange="toggleCopyTrading(this.checked)"></label>
      <div id="masterConsole"></div>
      <div id="childAccountsContainer"></div>
    </section>

    <section id="accountSection">
      <h2>ðŸ“ˆ Trade Summary</h2>
      <button onclick="downloadTradeSummaryCSV()">ðŸ“¥ Export CSV</button>
      <table id="tradeSummaryTable">
        <thead>
          <tr>
            <th data-key="name">Client ID</th>
            <th data-key="live_balance">Live Balance</th>
            <th data-key="net_pnl">Net P&L</th>
            <th data-key="total_trades">Total Trades</th>
            <th data-key="wins">Wins</th>
            <th data-key="losses">Losses</th>
            <th data-key="win_rate">Win Rate %</th>
            <th data-key="top_symbol">Top Symbol</th>
          </tr>
        </thead>
        <tbody id="tradeSummaryBody"></tbody>
      </table>
    </section>

    <section id="accountSection">
      <h2>ðŸ“¡ Chartink Triggers</h2>
      <button onclick="loadChartinkLog()">ðŸ”„ Refresh</button>
      <table id="chartinkTable" border="1" width="100%" style="margin-top:10px;">
        <thead>
          <tr>
            <th>Time</th>
            <th>Symbol</th>
            <th>Qty</th>
            <th>Action</th>
            <th>Chart</th>
          </tr>
        </thead>
        <tbody id="chartinkBody"></tbody>
      </table>
    </section>

    <div id="toast-container"></div>
  </main>

  <div class="modal" id="chartModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="chartTitle" class="modal-title">ðŸ“Š Chart</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <iframe id="tvChart" width="100%" height="500" frameborder="0"></iframe>
        </div>
      </div>
    </div>
  </div>

<script>
function showTab(id) {
  const sections = ['accountSection', 'copySection', 'summarySection', 'chartinkSection'];
  sections.forEach(sec => {
    document.getElementById(sec).style.display = (sec === id) ? 'block' : 'none';
  });
  if (id === 'chartinkSection') loadChartinkLog();
}
</script>
<script src="/static/dashboard.js"></script>
</body>
</html>
